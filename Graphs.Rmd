---
title: "Graphs"
author: "Aidan Dold"
date: "2025-10-13"
output: html_document
---

```{r}
library(dplyr)
library(ggplot2)
library(tidyr)
```


```{r}
data %>%
  count(winner, name = "total_wins") %>%
  ggplot(aes(x = reorder(winner, -total_wins), y = total_wins)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  labs(title = "Total Wins by Team",
       x = "Team",
       y = "Number of Wins") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```


```{r}
# Combine all team appearances into one long list
all_teams <- data %>%
  select(team_home, team_away) %>%
  tidyr::pivot_longer(cols = everything(), values_to = "team")

# Count total games played by each team
games_played <- all_teams %>%
  count(team, name = "games_played")

# Count total wins by each team
wins <- data %>%
  count(winner, name = "wins") %>%
  rename(team = winner)

# Join wins and games played
win_pct <- full_join(games_played, wins, by = "team") %>%
  mutate(wins = replace_na(wins, 0),
         win_pct = wins / games_played)

# Plot winning percentage
ggplot(win_pct, aes(x = reorder(team, -win_pct), y = win_pct, fill = win_pct)) +
  geom_bar(stat = "identity") +
  scale_fill_gradient(low = "red", high = "green") +
  labs(title = "Winning Percentage by Team",
       x = "Team",
       y = "Winning Percentage",
       fill = "Win %") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```



```{r}
# Count total games played at each stadium
games_played <- data %>%
  count(stadium, name = "games_played")

# Count total wins by stadium (how many games were won by the home team or any winner there)
wins <- data %>%
  group_by(stadium) %>%
  summarise(wins = n())  # every game played at stadium counts as a win for that stadium

# Calculate winning percentage (which will be 1 here because every game is played at one stadium)
# But if you want winning percentages by stadium for a specific team or condition, please clarify.

# For simplicity, let's just calculate the win rate of the home team per stadium if you have a `home_team` column:

if ("team_home" %in% names(data)) {
  home_wins <- data %>%
    mutate(home_win = ifelse(winner == team_home, 1, 0)) %>%
    group_by(stadium) %>%
    summarise(home_wins = sum(home_win),
              games_played = n(),
              win_pct = home_wins / games_played)

  # Plot winning percentage by stadium
  ggplot(home_wins, aes(x = reorder(stadium, -win_pct), y = win_pct, fill = win_pct)) +
    geom_bar(stat = "identity") +
    scale_fill_gradient(low = "red", high = "green") +
    labs(title = "Home Team Winning Percentage by Stadium",
         x = "Stadium",
         y = "Winning Percentage",
         fill = "Win %") +
    scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
}
```


```{r}
# Clean and summarize the data
team_spread_summary <- data %>%
  filter(Spread_Correct. %in% c("Yes", "No")) %>%
  group_by(team_favorite_name) %>%
  summarise(
    total_games = n(),
    covered = sum(Spread_Correct. == "Yes"),
    pct_covered = covered / total_games
  ) %>%
  arrange(desc(pct_covered))

# Plot it
ggplot(team_spread_summary, aes(x = reorder(team_favorite_name, pct_covered), y = pct_covered, fill = pct_covered)) +
  geom_col() +
  coord_flip() +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  scale_fill_gradient(low = "red", high = "green") +
  labs(
    title = "Percent of Games Favorite Covered the Spread",
    x = "Favorite Team",
    y = "Percent of Games Covered",
    fill = "Cover %"
  ) +
  theme_minimal()
```


```{r}
# Step 1: Reshape the data so each row represents one team in one game
team_games <- data %>%
  select(team_home, team_away, Over_Under_Hit) %>%
  pivot_longer(cols = c(team_home, team_away), names_to = "home_or_away", values_to = "team")

# Step 2: Calculate over hit rate per team
team_over_rates <- team_games %>%
  group_by(team) %>%
  summarise(
    games_played = n(),
    over_hits = sum(Over_Under_Hit == "Over"),
    pct_over_hit = over_hits / games_played
  ) %>%
  arrange(desc(pct_over_hit))

# Step 3: Plot the results
ggplot(team_over_rates, aes(x = reorder(team, pct_over_hit), y = pct_over_hit, fill = pct_over_hit)) +
  geom_col() +
  coord_flip() +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  scale_fill_gradient(low = "red", high = "green") +
  labs(
    title = "Percent of Games Hitting the Over by Team",
    x = "Team",
    y = "Percent of Games Over",
    fill = "Over Hit %"
  ) +
  theme_minimal()

```

```{r}

# Summarize how often each favorite team won when favored
favorite_team_reliability <- data %>%
  filter(fav_correct %in% c("Yes", "No"), !is.na(team_favorite_name)) %>%
  group_by(team_favorite_name) %>%
  summarise(
    games_favored = n(),
    games_won = sum(fav_correct == "Yes"),
    pct_won_when_favored = games_won / games_favored
  ) %>%
  arrange(desc(pct_won_when_favored))

# Plot
ggplot(favorite_team_reliability, aes(x = reorder(team_favorite_name, pct_won_when_favored), y = pct_won_when_favored, fill = pct_won_when_favored)) +
  geom_col() +
  coord_flip() +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  scale_fill_gradient(low = "red", high = "green") +
  labs(
    title = "Team Win Rate When Favored",
    x = "Team (When Favored)",
    y = "Win % as Favorite",
    fill = "Win %"
  ) +
  theme_minimal()

```

